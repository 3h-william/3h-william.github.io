<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>hbase bulkload 相关整理 | 3h_william</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="由于近期Team内有同学用到bulkload,整理了一下过往我用到的bulkload的相关使用经验基于hbase 0.90和0.94版本做一些简单的分析，可供参考。  
1. 概述官方说明[0.94官方说明] (http://hbase.apache.org/0.94/book/arch.bulk.load.html)  
简单的说，bluk load 是能够批量加载hfile =&amp;gt; hba">
<meta property="og:type" content="article">
<meta property="og:title" content="hbase bulkload 相关整理">
<meta property="og:url" content="http://3h-william.github.io/2015/08/27/hbase-bulkload/index.html">
<meta property="og:site_name" content="3h_william">
<meta property="og:description" content="由于近期Team内有同学用到bulkload,整理了一下过往我用到的bulkload的相关使用经验基于hbase 0.90和0.94版本做一些简单的分析，可供参考。  
1. 概述官方说明[0.94官方说明] (http://hbase.apache.org/0.94/book/arch.bulk.load.html)  
简单的说，bluk load 是能够批量加载hfile =&amp;gt; hba">
<meta property="og:updated_time" content="2017-02-25T09:44:25.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="hbase bulkload 相关整理">
<meta name="twitter:description" content="由于近期Team内有同学用到bulkload,整理了一下过往我用到的bulkload的相关使用经验基于hbase 0.90和0.94版本做一些简单的分析，可供参考。  
1. 概述官方说明[0.94官方说明] (http://hbase.apache.org/0.94/book/arch.bulk.load.html)  
简单的说，bluk load 是能够批量加载hfile =&amp;gt; hba">
    

    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">3h_william</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/me.jpg" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/me.jpg" />
            <h2 id="name">3h_william</h2>
            <h3 id="title">Bigdata Team Manager Architect</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Shanghai, China</span>
            <a id="follow" target="_blank" href="http://www.weibo.com/3hwilliam">FOLLOW</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                11
                <span>posts</span>
            </div>
            <div class="article-info-block">
                13
                <span>tags</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="/3h-william" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="http://www.weibo.com/3hwilliam" target="_blank" title="weibo" class=tooltip>
                            <i class="fa fa-weibo"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main"><article id="post-hbase-bulkload" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            hbase bulkload 相关整理
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2015/08/27/hbase-bulkload/">
            <time datetime="2015-08-27T06:08:11.000Z" itemprop="datePublished">2015-08-27</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/hbase/">hbase</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>由于近期Team内有同学用到bulkload,整理了一下过往我用到的bulkload的相关使用经验<br>基于<strong>hbase 0.90</strong>和<strong>0.94</strong>版本做一些简单的分析，可供参考。  </p>
<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a><strong>1. 概述</strong></h2><p><a href="http://hbase.apache.org/book.html#arch.bulk.load" target="_blank" rel="external">官方说明</a><br>[0.94官方说明] (<a href="http://hbase.apache.org/0.94/book/arch.bulk.load.html" target="_blank" rel="external">http://hbase.apache.org/0.94/book/arch.bulk.load.html</a>)  </p>
<p>简单的说，bluk load 是能够批量加载hfile =&gt; hbase的技术。<br>服务端，RegionServer处理客户端的bulkload请求。<br>客户端，向RegionServer发起blukload请求。  </p>
<h3 id="1-1-案例"><a href="#1-1-案例" class="headerlink" title="1.1. 案例"></a><strong>1.1. 案例</strong></h3><p>在2013年的maillog项目中，我们使用了bulk load技术。批量加载了从M/R生成的HFile数据。<br>因为是预先生成的HFile和处理过的，所以是一个HFile对应1个Region</p>
<h4 id="加载数据量"><a href="#加载数据量" class="headerlink" title="加载数据量:"></a><strong>加载数据量:</strong></h4><p>HFile(Region) 总数: <strong>100个</strong><br>占用磁盘大小 : <strong>450G</strong> (snappy压缩后<strong>100G</strong>)<br>消耗时间 : 在数据已经存在与HDFS的情况下，每一个HFile加载时间 <strong>小于 1秒</strong>    </p>
<h3 id="1-2-特性"><a href="#1-2-特性" class="headerlink" title="1.2 特性"></a><strong>1.2 特性</strong></h3><p><strong>a)</strong> bulkload 在加载的同时，并不会影响正常读写。(如果写文件造成分区变化，对bulkload有影响)<br><strong>b)</strong> bulkload 的加载是秒级的，在同一个HDFS cluster中，会将数据move。<br><strong>c)</strong> bulkload 也支持从不同的hdfs cluster copy数据(不同版本没有测试过)，同一个版本可行，它会把原来的move操作替换为copy，效率会降低。<br>(<strong>注意</strong>: 如果你的数据没有move而是copy，请check一下hdfs的URI写的是否正确一致)</p>
<h3 id="1-3-空表和非空表的策略"><a href="#1-3-空表和非空表的策略" class="headerlink" title="1.3. 空表和非空表的策略"></a><strong>1.3. 空表和非空表的策略</strong></h3><h4 id="场景定义"><a href="#场景定义" class="headerlink" title="场景定义"></a>场景定义</h4><p>bulkload 适用于初始化整个HBase表(空表)， 也适用于对于增量数据的导入（非空表）  </p>
<h4 id="策略"><a href="#策略" class="headerlink" title="策略"></a>策略</h4><p>显然，对于这两种场景的操作手法和策略是不同的。<br>对于任何的bulkload操作策略来说，评判目标应该是一致的: <strong>效率和影响</strong><br><strong>效率</strong> 指的是如何在短时间内将数据load。<br><strong>影响</strong> 指的是如何避免在做bulkload的时候，减少对集群的影响，避免hbase触发split/merge等heavy的操作。    </p>
<h4 id="操作手法一般包括："><a href="#操作手法一般包括：" class="headerlink" title="操作手法一般包括："></a>操作手法一般包括：</h4><p><strong>a) HFile的预处理</strong>  通过M/R Job或者其他手段预先处理HFile，可以定义HFile大小，splitkey规则，可以在非空表的情况下，极大避免对集群的影响。<br><strong>b) 预分区</strong>  通常来说，对于空表的bulkload应该是不会触发集群的split、merge等操作的。通过预分区可以有效的规避这一点。和Hbase 的split size结合使用。 </p>
<h2 id="2-Bulkload客户端流程"><a href="#2-Bulkload客户端流程" class="headerlink" title="2. Bulkload客户端流程"></a><strong>2. Bulkload客户端流程</strong></h2><p>主要围绕<strong>LoadIncrementalHFiles</strong> 类来说明基本的流程。<br>可参考我上传的代码，对比以下链接的代码<br>[0.90版本官方提供的LoadIncrementalHFiles类] (<a href="http://trgit2/wz68/importdb_blukload/blob/master/src/main/java/com/newegg/email/importdb/bulkload/tool/LoadIncrementalHFiles.java" target="_blank" rel="external">http://trgit2/wz68/importdb_blukload/blob/master/src/main/java/com/newegg/email/importdb/bulkload/tool/LoadIncrementalHFiles.java</a>)<br>[基于0.90版本修改后支持客户端并发的LoadIncrementalHFilesConcurrency类]  (<a href="http://trgit2/wz68/importdb_blukload/blob/master/src/main/java/com/newegg/email/importdb/bulkload/tool/LoadIncrementalHFilesConcurrency.java" target="_blank" rel="external">http://trgit2/wz68/importdb_blukload/blob/master/src/main/java/com/newegg/email/importdb/bulkload/tool/LoadIncrementalHFilesConcurrency.java</a>)<br>总的来说，这部分代码比较简单，客户端代码很容易读懂。</p>
<h3 id="Step-1-main-entry"><a href="#Step-1-main-entry" class="headerlink" title="Step 1.  main entry"></a>Step 1.  main entry</h3><p>  LoadIncrementalHFiles的entry方法，会接收两个参数，一个是表的名字，另一个是<strong>hfile文件或文件夹路径</strong>(此处可传递文件夹)<br>  这里的LoadIncrementalHFiles是implements于org.apache.hadoop.util.Tool，但是因为这里只是借助于tool这个工具，实质上并没有启动任何M/R job，因此我们看到的只是一个local的app启动。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">   // entry 方法</div><div class="line">   public static void main(String[] args) throws Exception &#123;</div><div class="line">       int ret = ToolRunner.run(new LoadIncrementalHFiles(HBaseConfiguration.create()), args);</div><div class="line">    System.exit(ret);</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   // tool的默认加载方法run</div><div class="line">public int run(String[] args) throws Exception &#123;</div><div class="line">	if (args.length != 2) &#123;</div><div class="line">		usage();</div><div class="line">		return -1;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	String dirPath = args[0];      // ---&gt; 路径(文件、文件夹)</div><div class="line">	String tableName = args[1];    // ---&gt; table name</div><div class="line"></div><div class="line">	boolean tableExists = this.doesTableExist(tableName);</div><div class="line">	if (!tableExists)</div><div class="line">		this.createTable(tableName, dirPath);</div><div class="line"></div><div class="line">	Path hfofDir = new Path(dirPath);</div><div class="line">	HTable table = new HTable(conf,tableName);</div><div class="line"></div><div class="line">	doBulkLoad(hfofDir, table);   // ---&gt; 调用bulkload方法</div><div class="line">	return 0;                     // ---&gt;  Run方法中并没有调用M/R job client，因此只是一个local app，不能算是M/R的job</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Step-2-串行化和并行化-doBulkLoad"><a href="#Step-2-串行化和并行化-doBulkLoad" class="headerlink" title="Step 2 . 串行化和并行化 doBulkLoad"></a>Step 2 . 串行化和并行化 doBulkLoad</h3><p>串行化和并行化目前已经在高版本应该解决了。  </p>
<h4 id="a-0-90版本的串行化-以下这段是官方提供的代码，我们可以看到tryLoad是循环的。所以无法并发去做。"><a href="#a-0-90版本的串行化-以下这段是官方提供的代码，我们可以看到tryLoad是循环的。所以无法并发去做。" class="headerlink" title="a)  0.90版本的串行化: 以下这段是官方提供的代码，我们可以看到tryLoad是循环的。所以无法并发去做。"></a><strong>a)</strong>  0.90版本的串行化: 以下这段是官方提供的代码，我们可以看到tryLoad是循环的。所以无法并发去做。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">public void doBulkLoad(Path hfofDir, HTable table) throws TableNotFoundException, IOException &#123;</div><div class="line">	HConnection conn = table.getConnection();</div><div class="line"></div><div class="line">	if (!conn.isTableAvailable(table.getTableName())) &#123;</div><div class="line">		throw new TableNotFoundException(&quot;Table &quot; + Bytes.toStringBinary(table.getTableName()) + &quot;is not currently available.&quot;);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	Deque&lt;LoadQueueItem&gt; queue = null;</div><div class="line">	try &#123;</div><div class="line">		queue = discoverLoadQueue(hfofDir);</div><div class="line">		while (!queue.isEmpty()) &#123;                                // ----&gt;  串行化消费队列，提交bulkload</div><div class="line">			LoadQueueItem item = queue.remove();</div><div class="line">			tryLoad(item, conn, table.getTableName(), queue);</div><div class="line">		&#125;</div><div class="line">	&#125; finally &#123;</div><div class="line">		if (queue != null &amp;&amp; !queue.isEmpty()) &#123;</div><div class="line">			StringBuilder err = new StringBuilder();</div><div class="line">			err.append(&quot;-------------------------------------------------\n&quot;);</div><div class="line">			err.append(&quot;Bulk load aborted with some files not yet loaded:\n&quot;);</div><div class="line">			err.append(&quot;-------------------------------------------------\n&quot;);</div><div class="line">			for (LoadQueueItem q : queue) &#123;</div><div class="line">				err.append(&quot;  &quot;).append(q.hfilePath).append(&apos;\n&apos;);</div><div class="line">			&#125;</div><div class="line">			LOG.error(err);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="b-基于0-90版本修改的并行化方案，通过构建线程池来完成。"><a href="#b-基于0-90版本修改的并行化方案，通过构建线程池来完成。" class="headerlink" title="b)  基于0.90版本修改的并行化方案，通过构建线程池来完成。"></a><strong>b)</strong>  基于0.90版本修改的并行化方案，通过构建线程池来完成。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">public boolean doBulkLoad(Path hfofDir, HTable table) throws TableNotFoundException, IOException &#123;</div><div class="line">	boolean isSuccess=false;</div><div class="line">	HConnection conn = table.getConnection();</div><div class="line">	</div><div class="line">	if (!conn.isTableAvailable(table.getTableName())) &#123;</div><div class="line">		throw new TableNotFoundException(&quot;Table &quot; + Bytes.toStringBinary(table.getTableName()) + &quot;is not currently available.&quot;);</div><div class="line">	&#125;</div><div class="line">	List&lt;Deque&lt;LoadQueueItem&gt;&gt; queueList = null;</div><div class="line">	// Deque&lt;LoadQueueItem&gt; queue = null;</div><div class="line">	queueList = discoverLoadQueue(hfofDir);</div><div class="line">	int threadNums=conf.getInt(CONCURRENCY_NUMS, 1);</div><div class="line">	LOG.info(&quot;*********    thread nums = &quot;+threadNums);</div><div class="line">	ExecutorService executorService = Executors.newFixedThreadPool(threadNums);                //  -----&gt; 并行化解决方案</div><div class="line">	List&lt;Future&lt;Boolean&gt;&gt; resultList = new ArrayList&lt;Future&lt;Boolean&gt;&gt;();</div><div class="line">	try&#123;</div><div class="line">		for (Deque&lt;LoadQueueItem&gt; queue : queueList) &#123;</div><div class="line">			Future&lt;Boolean&gt; future =executorService.submit(new LoadThread(queue, conn, table.getTableName()));</div><div class="line">			resultList.add(future);</div><div class="line">		&#125;</div><div class="line">		for (Future&lt;Boolean&gt; result : resultList) &#123;</div><div class="line">			if (!result.get(100, TimeUnit.MINUTES)) &#123;</div><div class="line">				LOG.error(&quot;validatorThread return false&quot;);</div><div class="line">				return false;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		isSuccess = true;</div><div class="line">	&#125;catch(Exception e)&#123;</div><div class="line">		LOG.error(e);</div><div class="line">	&#125;finally&#123;</div><div class="line">		executorService.shutdown();</div><div class="line">		return isSuccess;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="c-官方0-94的版本的代码片段，已经提供了并行化，并且大幅修改了代码，开启并行化，需要手动设置参数-hbase-loadincremental-threads-max，默认值是机器的cpu-cores相关"><a href="#c-官方0-94的版本的代码片段，已经提供了并行化，并且大幅修改了代码，开启并行化，需要手动设置参数-hbase-loadincremental-threads-max，默认值是机器的cpu-cores相关" class="headerlink" title="c) 官方0.94的版本的代码片段，已经提供了并行化，并且大幅修改了代码，开启并行化，需要手动设置参数: hbase.loadincremental.threads.max，默认值是机器的cpu cores相关"></a><strong>c)</strong> 官方0.94的版本的代码片段，已经提供了并行化，并且大幅修改了代码，开启并行化，需要手动设置参数: <strong>hbase.loadincremental.threads.max</strong>，默认值是机器的cpu cores相关</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">public void doBulkLoad(Path hfofDir, final HTable table)</div><div class="line">   throws TableNotFoundException, IOException</div><div class="line"> &#123;</div><div class="line">   final HConnection conn = table.getConnection();</div><div class="line"></div><div class="line">   if (!conn.isTableAvailable(table.getTableName())) &#123;</div><div class="line">     throw new TableNotFoundException(&quot;Table &quot; +</div><div class="line">         Bytes.toStringBinary(table.getTableName()) +</div><div class="line">         &quot;is not currently available.&quot;);</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   // initialize thread pools                                                        ----&gt;  并行化处理加载HFile</div><div class="line">   int nrThreads = cfg.getInt(&quot;hbase.loadincremental.threads.max&quot;,</div><div class="line">       Runtime.getRuntime().availableProcessors());</div><div class="line">   ThreadFactoryBuilder builder = new ThreadFactoryBuilder();</div><div class="line">   builder.setNameFormat(&quot;LoadIncrementalHFiles-%1$d&quot;);</div><div class="line">   ExecutorService pool = new ThreadPoolExecutor(nrThreads, nrThreads,</div><div class="line">       60, TimeUnit.SECONDS,</div><div class="line">       new LinkedBlockingQueue&lt;Runnable&gt;(),</div><div class="line">       builder.build());</div><div class="line">   ((ThreadPoolExecutor)pool).allowCoreThreadTimeOut(true);</div><div class="line"></div><div class="line"></div><div class="line">   ......</div></pre></td></tr></table></figure>
<h3 id="Step-3-查看hfile边界，以决定是否需要split"><a href="#Step-3-查看hfile边界，以决定是否需要split" class="headerlink" title="Step 3. 查看hfile边界，以决定是否需要split"></a>Step 3. 查看hfile边界，以决定是否需要split</h3><p>这个地方就是是否会在客户端发生split的原因<br>直接参考0.94的代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">   * Attempt to assign the given load queue item into its target region group.</div><div class="line">   * If the hfile boundary no longer fits into a region, physically splits</div><div class="line">   * the hfile such that the new bottom half will fit and returns the list of</div><div class="line">   * LQI&apos;s corresponding to the resultant hfiles.</div><div class="line">   *</div><div class="line">   * protected for testing</div><div class="line">   */</div><div class="line">  protected List&lt;LoadQueueItem&gt; groupOrSplit(Multimap&lt;ByteBuffer, LoadQueueItem&gt; regionGroups,</div><div class="line">      final LoadQueueItem item, final HTable table,</div><div class="line">      final Pair&lt;byte[][], byte[][]&gt; startEndKeys)</div><div class="line">      throws IOException &#123;</div><div class="line">    final Path hfilePath = item.hfilePath;</div><div class="line">    final FileSystem fs = hfilePath.getFileSystem(getConf());</div><div class="line">    HFile.Reader hfr = HFile.createReader(fs, hfilePath,</div><div class="line">        new CacheConfig(getConf()));</div><div class="line">    final byte[] first, last;</div><div class="line">    try &#123;</div><div class="line">      hfr.loadFileInfo();</div><div class="line">      first = hfr.getFirstRowKey();</div><div class="line">      last = hfr.getLastRowKey();</div><div class="line">    &#125;  finally &#123;</div><div class="line">      hfr.close();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    LOG.info(&quot;Trying to load hfile=&quot; + hfilePath +                       ----&gt; 从hfile中得到first 和 last的信息</div><div class="line">        &quot; first=&quot; + Bytes.toStringBinary(first) +</div><div class="line">        &quot; last=&quot;  + Bytes.toStringBinary(last));</div><div class="line">    if (first == null || last == null) &#123;</div><div class="line">      assert first == null &amp;&amp; last == null;</div><div class="line">      // TODO what if this is due to a bad HFile?</div><div class="line">      LOG.info(&quot;hfile &quot; + hfilePath + &quot; has no entries, skipping&quot;);</div><div class="line">      return null;</div><div class="line">    &#125;</div><div class="line">    if (Bytes.compareTo(first, last) &gt; 0) &#123;                              </div><div class="line">      throw new IllegalArgumentException(</div><div class="line">      &quot;Invalid range: &quot; + Bytes.toStringBinary(first) +</div><div class="line">      &quot; &gt; &quot; + Bytes.toStringBinary(last));</div><div class="line">    &#125;</div><div class="line">    int idx = Arrays.binarySearch(startEndKeys.getFirst(), first,        ---&gt;  从整个集群的statEndKeys的多列中搜索是否满足该HFile的Region</div><div class="line">        Bytes.BYTES_COMPARATOR);</div><div class="line">    if (idx &lt; 0) &#123;</div><div class="line">      // not on boundary, returns -(insertion index).  Calculate region it</div><div class="line">      // would be in.</div><div class="line">      idx = -(idx + 1) - 1;</div><div class="line">    &#125;</div><div class="line">    final int indexForCallable = idx;</div><div class="line">    boolean lastKeyInRange =</div><div class="line">      Bytes.compareTo(last, startEndKeys.getSecond()[idx]) &lt; 0 ||</div><div class="line">      Bytes.equals(startEndKeys.getSecond()[idx], HConstants.EMPTY_BYTE_ARRAY);</div><div class="line">    if (!lastKeyInRange) &#123;</div><div class="line">      List&lt;LoadQueueItem&gt; lqis = splitStoreFile(item, table,             ---&gt;  如果不满足，就会触发客户端split，调用splitStoreFile方法这里就时效率慢的原因！！！！</div><div class="line">          startEndKeys.getFirst()[indexForCallable],</div><div class="line">          startEndKeys.getSecond()[indexForCallable]);</div><div class="line">      return lqis;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // group regions.</div><div class="line">    regionGroups.put(ByteBuffer.wrap(startEndKeys.getFirst()[idx]), item);         ---&gt; 如果HFile满足区间，或者是已经将不满足区间的HFile切分满足，那么就加到RegionGroup中，等待加载.</div><div class="line">    return null;</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<h3 id="Step-4-客户端split的两个方法"><a href="#Step-4-客户端split的两个方法" class="headerlink" title="Step 4. 客户端split的两个方法"></a>Step 4. 客户端split的两个方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">// 决定split的范围，数量，分区</div><div class="line">  protected List&lt;LoadQueueItem&gt; splitStoreFile(final LoadQueueItem item,</div><div class="line">      final HTable table, byte[] startKey,</div><div class="line">      byte[] splitKey) throws IOException &#123;</div><div class="line">    final Path hfilePath = item.hfilePath;</div><div class="line"></div><div class="line">    // We use a &apos;_&apos; prefix which is ignored when walking directory trees</div><div class="line">    // above.</div><div class="line">    final Path tmpDir = new Path(item.hfilePath.getParent(), &quot;_tmp&quot;);</div><div class="line"></div><div class="line">    LOG.info(&quot;HFile at &quot; + hfilePath + &quot; no longer fits inside a single &quot; +</div><div class="line">    &quot;region. Splitting...&quot;);</div><div class="line"></div><div class="line">    String uniqueName = getUniqueName(table.getTableName());</div><div class="line">    HColumnDescriptor familyDesc = table.getTableDescriptor().getFamily(item.family);</div><div class="line">    Path botOut = new Path(tmpDir, uniqueName + &quot;.bottom&quot;);</div><div class="line">    Path topOut = new Path(tmpDir, uniqueName + &quot;.top&quot;);</div><div class="line">    splitStoreFile(getConf(), hfilePath, familyDesc, splitKey,</div><div class="line">        botOut, topOut);</div><div class="line"></div><div class="line">    // Add these back at the *front* of the queue, so there&apos;s a lower</div><div class="line">    // chance that the region will just split again before we get there.</div><div class="line">    List&lt;LoadQueueItem&gt; lqis = new ArrayList&lt;LoadQueueItem&gt;(2);</div><div class="line">    lqis.add(new LoadQueueItem(item.family, botOut));</div><div class="line">    lqis.add(new LoadQueueItem(item.family, topOut));</div><div class="line"></div><div class="line">    LOG.info(&quot;Successfully split into new HFiles &quot; + botOut + &quot; and &quot; + topOut);      // 如果split成功，我们会看到这些日志...</div><div class="line">    return lqis;</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  </div><div class="line">  // 真正调用执行split,copy....</div><div class="line">  </div><div class="line">    /**</div><div class="line">   * Split a storefile into a top and bottom half, maintaining</div><div class="line">   * the metadata, recreating bloom filters, etc.</div><div class="line">   */</div><div class="line">  static void splitStoreFile(</div><div class="line">      Configuration conf, Path inFile,</div><div class="line">      HColumnDescriptor familyDesc, byte[] splitKey,</div><div class="line">      Path bottomOut, Path topOut) throws IOException</div><div class="line">  &#123;</div><div class="line">    // Open reader with no block cache, and not in-memory</div><div class="line">    Reference topReference = new Reference(splitKey, Range.top);</div><div class="line">    Reference bottomReference = new Reference(splitKey, Range.bottom);</div><div class="line"></div><div class="line">    copyHFileHalf(conf, inFile, topOut, topReference, familyDesc);                    -----&gt; 客户端split的真正copy的方法</div><div class="line">    copyHFileHalf(conf, inFile, bottomOut, bottomReference, familyDesc); </div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h2 id="3-Q-amp-A"><a href="#3-Q-amp-A" class="headerlink" title="3. Q&amp;A"></a><strong>3. Q&amp;A</strong></h2><h3 id="1-Q-目前的工具是否是并行化加载"><a href="#1-Q-目前的工具是否是并行化加载" class="headerlink" title="1)  Q:  目前的工具是否是并行化加载?"></a><strong>1)  Q:  目前的工具是否是并行化加载?</strong></h3><pre><code>通过上面的分析，我们可以看到，从0.94开始就已经是有并行化处理了，因此我们不需要再像我之前的那种方式去做了。只要定义好自己的线程池大小就ok.   
但我们也需要注意的是，由于**LoadIncrementalHFiles** 工具并不是M/R job，所以不要指望能直接通过M/R来提高效率。  
</code></pre><h3 id="2-Q-如果避免split"><a href="#2-Q-如果避免split" class="headerlink" title="2)  Q:  如果避免split?"></a><strong>2)  Q:  如果避免split?</strong></h3><pre><code>split有两个定义。一个是客户端的split，另一个是Region Server的split。  
在空表情况下，通过预分区的方式，只要key分的准确，就不会触发客户端的split。结合hbase 原本的 split size 参数，使HFile对应的HRegion大小合适，不会造成RSr的split.
</code></pre><h3 id="3-Q-对空表的bulkload的过程中，可否正常读写"><a href="#3-Q-对空表的bulkload的过程中，可否正常读写" class="headerlink" title="3)  Q:  对空表的bulkload的过程中，可否正常读写?"></a><strong>3)  Q:  对空表的bulkload的过程中，可否正常读写?</strong></h3><pre><code>读肯定是没有问题的，写的话，如果数据量不大，不触发Region的split，则也没有关系。  
</code></pre><h3 id="4-Q-为什么bulkload的过程中，在数据已经准备的情况下，效率那么快，秒级别加载，并且不会disable-Region"><a href="#4-Q-为什么bulkload的过程中，在数据已经准备的情况下，效率那么快，秒级别加载，并且不会disable-Region" class="headerlink" title="4)  Q:  为什么bulkload的过程中，在数据已经准备的情况下，效率那么快，秒级别加载，并且不会disable Region?"></a><strong>4)  Q:  为什么bulkload的过程中，在数据已经准备的情况下，效率那么快，秒级别加载，并且不会disable Region?</strong></h3><pre><code>前面只分析了Bulkload的客户端代码，如果去翻阅一下服务端代码我们可以知道。对于RS来说，bulkload就两件事情，第一件是mv文件，第二件是在RS的memory里加上新HFile的meta信息。  
</code></pre><h3 id="5-Q-对于非空表的增量数据bulkload，基本策略有哪些"><a href="#5-Q-对于非空表的增量数据bulkload，基本策略有哪些" class="headerlink" title="5)  Q:  对于非空表的增量数据bulkload，基本策略有哪些?"></a><strong>5)  Q:  对于非空表的增量数据bulkload，基本策略有哪些?</strong></h3><pre><code>参考步骤如下:  
a)  对新增HFiles大小做预估计，如果当前cluster可以容纳，则不需要预分区，否则，可以先预分区。  
b)  通过M/R对HFile做符合当前集群分区情况进行切分。  
c)  加载。  
</code></pre><p>对此，官方设计中有一段说明:<br>If the region boundaries have changed during the course of bulk load preparation, or between the preparation and completion steps, the completebulkloads utility will automatically split the data files into pieces corresponding to the new boundaries. This process is not optimally efficient, so users should take care to minimize the delay between preparing a bulk load and importing it into the cluster, especially if other clients are simultaneously loading data through other means.</p>
<p>大致意思是，即使客户端工具能够完成split的工作，但并不是最有效的方式，用户应该注意边界问题。</p>
<hr>
<p>作者：3h_william<br>联系: <a href="https://github.com/3h-william" target="_blank" rel="external">https://github.com/3h-william</a><br>出处：<a href="http://3h-william.github.io">http://3h-william.github.io</a>  </p>
<hr>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://3h-william.github.io/2015/08/27/hbase-bulkload/" data-id="cizl6b1xr0005vs090d5t6stj" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://3h-william.github.io/2015/08/27/hbase-bulkload/#comments" class="article-comment-link">Comments</a>
    

        </footer>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2015/09/08/hbase_balance_problem/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Newer</strong>
            <div class="article-nav-title">
                
                    HBase Coprocessor问题引起异常Balance
                
            </div>
        </a>
    
    
        <a href="/2015/08/10/elasticsearch_dc/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Older</strong>
            <div class="article-nav-title">为ElasticSearch 添加支持跨DC的特性</div>
        </a>
    
</nav>


    
</article>


    
    <section id="comments">
    
        
    <div id="uyan_frame"></div>

    
    </section>

</section>
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">recent</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/02/25/akka_split_brain/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2017/02/25/akka_split_brain/" class="title">Akka集群对于脑裂的策略</a></p>
                            <p class="item-date"><time datetime="2017-02-25T09:35:00.000Z" itemprop="datePublished">2017-02-25</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/01/24/lft/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2017/01/24/lft/" class="title">新一代分布式调度系统--雷峰塔架构</a></p>
                            <p class="item-date"><time datetime="2017-01-24T07:30:11.000Z" itemprop="datePublished">2017-01-24</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2017/01/24/akka/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2017/01/24/akka/" class="title">项目中，使用akka的一些经验和总结</a></p>
                            <p class="item-date"><time datetime="2017-01-24T07:00:11.000Z" itemprop="datePublished">2017-01-24</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2015/11/10/zookeeper_stuck_dns_network/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2015/11/10/zookeeper_stuck_dns_network/" class="title">使用Zookeeper过程中遇到客户端stuck的问题和解决建议</a></p>
                            <p class="item-date"><time datetime="2015-11-10T01:18:11.000Z" itemprop="datePublished">2015-11-10</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2015/10/05/als_report/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2015/10/05/als_report/" class="title">推荐算法与协同过滤</a></p>
                            <p class="item-date"><time datetime="2015-10-05T06:08:11.000Z" itemprop="datePublished">2015-10-05</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    
        
    <div class="widget-wrap">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a><span class="archive-list-count">2</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">tags</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/MachineLearning/">MachineLearning</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/akka/">akka</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/elasticsearch/">elasticsearch</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hbase/">hbase</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hive/">hive</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scala/">scala</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/search/">search</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqoop/">sqoop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tsdb/">tsdb</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zookeeper/">zookeeper</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分布式系统/">分布式系统</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/技术产品/">技术产品</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/技术架构/">技术架构</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/MachineLearning/" style="font-size: 10px;">MachineLearning</a> <a href="/tags/akka/" style="font-size: 20px;">akka</a> <a href="/tags/elasticsearch/" style="font-size: 10px;">elasticsearch</a> <a href="/tags/hbase/" style="font-size: 20px;">hbase</a> <a href="/tags/hive/" style="font-size: 10px;">hive</a> <a href="/tags/scala/" style="font-size: 10px;">scala</a> <a href="/tags/search/" style="font-size: 10px;">search</a> <a href="/tags/sqoop/" style="font-size: 10px;">sqoop</a> <a href="/tags/tsdb/" style="font-size: 10px;">tsdb</a> <a href="/tags/zookeeper/" style="font-size: 10px;">zookeeper</a> <a href="/tags/分布式系统/" style="font-size: 10px;">分布式系统</a> <a href="/tags/技术产品/" style="font-size: 10px;">技术产品</a> <a href="/tags/技术架构/" style="font-size: 10px;">技术架构</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
        </div>
        <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            <span id="busuanzi_container_site_pv">
                本站总访问量<span id="busuanzi_value_site_pv"></span>次
            </span></br>
            <span id="busuanzi_container_site_uv">
              本站访客数<span id="busuanzi_value_site_uv"></span>人次
            </span></br>
            &copy; 2017 3h.william@gmail.com<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        </div>
    </div>
</footer>

        
    
    <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2126168"></script>



    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>